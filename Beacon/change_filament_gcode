{ if current_extruder != next_extruder }
SET_GCODE_VARIABLE MACRO=BOX_CHANGE_FILAMENT VARIABLE=max_layer_z VALUE={max_layer_z}
SET_GCODE_VARIABLE MACRO=BOX_CHANGE_FILAMENT VARIABLE=flush_length_1 VALUE={flush_length_1}
SET_GCODE_VARIABLE MACRO=BOX_CHANGE_FILAMENT VARIABLE=flush_length_2 VALUE={flush_length_2}
SET_GCODE_VARIABLE MACRO=BOX_CHANGE_FILAMENT VARIABLE=flush_length_3 VALUE={flush_length_3}
SET_GCODE_VARIABLE MACRO=BOX_CHANGE_FILAMENT VARIABLE=flush_length_4 VALUE={flush_length_4}
SET_GCODE_VARIABLE MACRO=BOX_CHANGE_FILAMENT VARIABLE=current_extruder VALUE={current_extruder}
SET_GCODE_VARIABLE MACRO=BOX_CHANGE_FILAMENT VARIABLE=current_filament_extrude_rate VALUE={old_filament_e_feedrate}
SET_GCODE_VARIABLE MACRO=BOX_CHANGE_FILAMENT VARIABLE=current_filament_high_temp VALUE={nozzle_temperature_range_high[current_extruder]}
SET_GCODE_VARIABLE MACRO=BOX_CHANGE_FILAMENT VARIABLE=current_filament_retract_length VALUE={old_retract_length_toolchange}
SET_GCODE_VARIABLE MACRO=BOX_CHANGE_FILAMENT VARIABLE=next_extruder VALUE={next_extruder}
SET_GCODE_VARIABLE MACRO=BOX_CHANGE_FILAMENT VARIABLE=next_filament_extrude_rate VALUE={new_filament_e_feedrate}
SET_GCODE_VARIABLE MACRO=BOX_CHANGE_FILAMENT VARIABLE=next_filament_temp VALUE={new_filament_temp}
SET_GCODE_VARIABLE MACRO=BOX_CHANGE_FILAMENT VARIABLE=next_filament_high_temp VALUE={nozzle_temperature_range_high[next_extruder]}
SET_GCODE_VARIABLE MACRO=BOX_CHANGE_FILAMENT VARIABLE=next_filament_retract_length VALUE={new_retract_length_toolchange}
SET_GCODE_VARIABLE MACRO=BOX_CHANGE_FILAMENT VARIABLE=retraction_distance_when_cut VALUE=0
BOX_CHANGE_FILAMENT C_FILA_TYPE={filament_type[current_extruder]} N_FILA_TYPE={filament_type[next_extruder]}
{endif}
